<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ëœë¤ ë½‘ê¸° - ë½‘ê¸° ì‹œë®¬ë ˆì´í„°</title>
    <link rel="icon" type="image/png" href="favicon.png" />
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- í—¤ë” -->
    <header class="header">
        <h1>ë°ì´í„° ê°€ì´ë“œ ëœë¤ ë½‘ê¸°</h1>
    </header>
    
    <!-- ë©”ì¸ ì»¨í…Œì´ë„ˆ -->
    <div class="main-container">
        <!-- ì¢Œì¸¡: ë°°í‹€ ë³´ë“œ -->
        <div class="battle-board">
            <canvas id="gameCanvas" width="1024" height="640"></canvas>
            
            <!-- ì•„ì´í…œ ì„¤ëª… ì˜ì—­ -->
            <div class="item-description">
                <h3>ğŸ¥Š ì•„ì´í…œ ì„¤ëª…</h3>
                <div class="item-cards">
                    <div class="item-card">
                        <div class="item-icon">âš¡</div>
                        <div class="item-info">
                            <h4>ìŠ¤í”¼ë“œ</h4>
                            <p>ì¼ì • ì‹œê°„ ë™ì•ˆ ì´ë™ ì†ë„ ì¦ê°€<br><strong>ì¤‘ì²© ì‹œ:</strong> 2ë°° â†’ 4ë°° â†’ 6ë°° â€¦</p>
                        </div>
                    </div>
                    <div class="item-card">
                        <div class="item-icon">ğŸ’–</div>
                        <div class="item-info">
                            <h4>ë¶€í™œ</h4>
                            <p>íƒˆë½í•œ ì°¸ê°€ìê°€ ë‹¤ì‹œ ë¶€í™œ<br><strong>ê²Œì„ë‹¹ íšŸìˆ˜ ì œí•œ ìˆìŒ</strong></p>
                        </div>
                    </div>
                    <div class="item-card">
                        <div class="item-icon">ğŸ¥Š</div>
                        <div class="item-info">
                            <h4>ê³µê²©</h4>
                            <p>ì¼ì • ì‹œê°„ ë™ì•ˆ í¬ê¸° ë¬´ì‹œí•˜ê³ <br><strong>ìƒëŒ€ë¥¼ ì²˜ì¹˜ ê°€ëŠ¥</strong></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ìš°ì¸¡: ì‚¬ì´ë“œë°” -->
        <div class="sidebar">
            
            
            <!-- ì°¸ê°€ì ì„ íƒ -->
            <div class="section">
                <div class="section-header">
                    <h3>ì¸ì› ì„ íƒ</h3>
                    <div class="selection-info">
                        <span class="counter">ì„ íƒ: <span id="selectedCount">0</span>ëª…</span>
                        <button id="selectAllBtn" class="btn-small">ì „ì²´ ì„ íƒ</button>
                    </div>
                </div>
                
                <div class="participant-list" id="participantList">
                    <!-- ì°¸ê°€ì ëª©ë¡ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
                </div>
            </div>
            
            <!-- ê²Œì„ ì„¤ì • -->
            <div class="section">
                <h3>ê²Œì„ ì„¤ì •</h3>
                
                <div class="form-group">
                    <label for="targetCount">ë‚¨ê¸¸ ì¸ì› ìˆ˜:</label>
                    <input type="number" id="targetCount" min="1" value="1" class="form-input">
                    <small class="form-help">1 â‰¤ N < ì„ íƒ ì¸ì› ìˆ˜</small>
                </div>
                

            </div>
            
            <!-- ê²Œì„ ì»¨íŠ¸ë¡¤ -->
            <div class="section">
                <h3>ê²Œì„ ì»¨íŠ¸ë¡¤</h3>
                
                <div class="button-group">
                    <button id="startBtn" class="btn btn-primary" disabled>Start</button>
                <button id="recordBtn" class="btn btn-secondary" disabled>í™”ë©´ ë…¹í™”</button>
                </div>
            </div>
            

            

            
            <!-- ë‹¹ì²¨ì ë¦¬ìŠ¤íŠ¸ (ê²Œì„ ì¢…ë£Œ ì‹œ í‘œì‹œ) -->
            <div class="section" id="winnerSection" style="display: none;">
                <h3>ğŸ‰ ë‹¹ì²¨ì ë¦¬ìŠ¤íŠ¸</h3>
                <div id="winnerList" class="winner-list">
                    <!-- ë‹¹ì²¨ìë“¤ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
                <button id="downloadCsvBtn" class="btn btn-success">CSV ë‹¤ìš´ë¡œë“œ</button>
            </div>
        </div>
    </div>

    <!-- ìŠ¤í¬ë¦½íŠ¸ -->
    <script type="module" src="main.js"></script>
    
    <!-- ì§ì ‘ ì°¸ê°€ì ëª©ë¡ ë Œë”ë§ (ë””ë²„ê¹…ìš©) -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ì§ì ‘ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰');
            
            const participantList = document.getElementById('participantList');
            console.log('participantList:', participantList);
            
            if (participantList) {
                const participants = [
                    { id: "bonah.fide", name: "ìœ ì§€ìš°" },
                    { id: "claire.hk", name: "ê¹€í¬ê²½" },
                    { id: "emma.kang", name: "ê°•ê²½ì„" },
                    { id: "genie.lamp", name: "ì‹¬ì§„í¬" },
                    { id: "izzy.so", name: "ì†¡í˜„ê²½" },
                    { id: "jadey.yoon", name: "ì´ì§€ìœ¤" },
                    { id: "jully.lee", name: "ì´ì •ì€" },
                    { id: "karel.kang", name: "ê°•ê¸°ê³¤" },
                    { id: "kent.coach", name: "ì¥í•œì¼" },
                    { id: "kimberly.lim", name: "ì„ìˆ˜ì—°" },
                    { id: "kuma.mon", name: "ê³ ìŠ¬ê¸°" },
                    { id: "luci.dor", name: "ê¹€ì—°í¬" },
                    { id: "maddison.ko", name: "ê³ ëª…ì„" },
                    { id: "miya.0", name: "ì´ë‹¤ì†œ" },
                    { id: "nathan.kwon", name: "ê¶Œì„±ì›" },
                    { id: "noah.se", name: "ì‹ ì†¡ì€" },
                    { id: "tomtom.s", name: "ì‹ ì€ì˜" },
                    { id: "william.lim", name: "ì„ì›êµ­" },
                    { id: "zo.7", name: "ì§€ì˜ì€" }
                ];
                
                participantList.innerHTML = '';
                
                participants.forEach(participant => {
                    const item = document.createElement('div');
                    item.className = 'participant-item';
                    item.dataset.id = participant.id;
                    
                    const checkbox = document.createElement('div');
                    checkbox.className = 'radio-checkbox';
                    checkbox.dataset.id = participant.id;
                    
                    const info = document.createElement('div');
                    info.className = 'participant-info';
                    
                    const idSpan = document.createElement('span');
                    idSpan.className = 'participant-id';
                    idSpan.textContent = participant.id;
                    
                    const nameSpan = document.createElement('span');
                    nameSpan.className = 'participant-name';
                    nameSpan.textContent = participant.name;
                    
                    info.appendChild(idSpan);
                    info.appendChild(nameSpan);
                    
                    item.appendChild(checkbox);
                    item.appendChild(info);
                    
                    // í´ë¦­ ì´ë²¤íŠ¸
                    item.addEventListener('click', () => {
                        const checkbox = item.querySelector('.radio-checkbox');
                        const isSelected = checkbox.classList.contains('selected');
                        
                        if (isSelected) {
                            checkbox.classList.remove('selected');
                        } else {
                            checkbox.classList.add('selected');
                        }
                        
                        // ì„ íƒëœ ì°¸ê°€ì ìˆ˜ ì—…ë°ì´íŠ¸
                        const selectedCount = document.getElementById('selectedCount');
                        if (selectedCount) {
                            const selectedItems = document.querySelectorAll('.radio-checkbox.selected');
                            selectedCount.textContent = selectedItems.length;
                        }
                        
                        // Start ë²„íŠ¼ í™œì„±í™”/ë¹„í™œì„±í™”
                        const startBtn = document.getElementById('startBtn');
                        if (startBtn) {
                            const selectedCount = document.querySelectorAll('.radio-checkbox.selected').length;
                            const targetCount = parseInt(document.getElementById('targetCount').value) || 1;
                            const canStart = selectedCount >= 2 && targetCount >= 1 && targetCount < selectedCount;
                            startBtn.disabled = !canStart;
                        }
                    });
                    
                    participantList.appendChild(item);
                });
                
                console.log('ì°¸ê°€ì ëª©ë¡ ì§ì ‘ ë Œë”ë§ ì™„ë£Œ');
                
                // ì „ì²´ ì„ íƒ/í•´ì œ ë²„íŠ¼ ê¸°ëŠ¥ êµ¬í˜„
                const selectAllBtn = document.getElementById('selectAllBtn');
                if (selectAllBtn) {
                    selectAllBtn.addEventListener('click', () => {
                        const allCheckboxes = document.querySelectorAll('.radio-checkbox');
                        const selectedCheckboxes = document.querySelectorAll('.radio-checkbox.selected');
                        
                        if (selectedCheckboxes.length === allCheckboxes.length) {
                            // ëª¨ë‘ ì„ íƒëœ ê²½ìš° ì „ì²´ í•´ì œ
                            allCheckboxes.forEach(checkbox => checkbox.classList.remove('selected'));
                            selectAllBtn.textContent = 'ì „ì²´ ì„ íƒ';
                        } else {
                            // ì „ì²´ ì„ íƒ
                            allCheckboxes.forEach(checkbox => checkbox.classList.add('selected'));
                            selectAllBtn.textContent = 'ì „ì²´ í•´ì œ';
                        }
                        
                        // ì„ íƒëœ ì°¸ê°€ì ìˆ˜ ì—…ë°ì´íŠ¸
                        const selectedCount = document.getElementById('selectedCount');
                        if (selectedCount) {
                            const selectedItems = document.querySelectorAll('.radio-checkbox.selected');
                            selectedCount.textContent = selectedItems.length;
                        }
                        
                        // Start ë²„íŠ¼ í™œì„±í™”/ë¹„í™œì„±í™”
                        const startBtn = document.getElementById('startBtn');
                        if (startBtn) {
                            const selectedCount = document.querySelectorAll('.radio-checkbox.selected').length;
                            const targetCount = parseInt(document.getElementById('targetCount').value) || 1;
                            const canStart = selectedCount >= 2 && targetCount >= 1 && targetCount < selectedCount;
                            startBtn.disabled = !canStart;
                        }
                    });
                }
                
                // Start ë²„íŠ¼ ì´ë²¤íŠ¸ ì¶”ê°€
                const startBtn = document.getElementById('startBtn');
                if (startBtn) {
                    startBtn.addEventListener('click', () => {
                        console.log('Start ë²„íŠ¼ í´ë¦­ë¨!');
                        
                        const selectedItems = document.querySelectorAll('.radio-checkbox.selected');
                        const selectedCount = selectedItems.length;
                        const targetCount = parseInt(document.getElementById('targetCount').value) || 1;
                        
                        console.log('ì„ íƒëœ ì°¸ê°€ì ìˆ˜:', selectedCount);
                        console.log('ëª©í‘œ ì¸ì› ìˆ˜:', targetCount);
                        
                        if (selectedCount < 2) {
                            alert('ìµœì†Œ 2ëª… ì´ìƒì˜ ì°¸ê°€ìë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                            return;
                        }
                        
                        if (targetCount < 1 || targetCount >= selectedCount) {
                            alert('ëª©í‘œ ì¸ì› ìˆ˜ëŠ” 1 ì´ìƒì´ê³  ì„ íƒëœ ì°¸ê°€ì ìˆ˜ë³´ë‹¤ ì‘ì•„ì•¼ í•©ë‹ˆë‹¤.');
                            return;
                        }
                        
                        // ë…¹í™” ì—¬ë¶€ í™•ì¸
                        const shouldRecord = confirm('í™”ë©´ ë…¹í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?');
                        
                        // ê²Œì„ ì‹œì‘ ë¡œì§ (ê°„ë‹¨í•œ í…ŒìŠ¤íŠ¸)
                        alert(`ê²Œì„ ì‹œì‘! ì„ íƒëœ ì°¸ê°€ì: ${selectedCount}ëª…, ëª©í‘œ: ${targetCount}ëª…`);
                        
                        // Start ë²„íŠ¼ ë¹„í™œì„±í™”
                        startBtn.disabled = true;
                        
                        // ë…¹í™” ë²„íŠ¼ í™œì„±í™” (ë…¹í™”ë¥¼ ì„ íƒí•œ ê²½ìš°ì—ë§Œ)
                        const recordBtn = document.getElementById('recordBtn');
                        if (recordBtn) {
                            recordBtn.disabled = !shouldRecord;
                            
                            // ë…¹í™”ë¥¼ ì„ íƒí•œ ê²½ìš° ìë™ìœ¼ë¡œ ë…¹í™” ì‹œì‘
                            if (shouldRecord) {
                                // ìº”ë²„ìŠ¤ê°€ ì¤€ë¹„ëœ í›„ ë…¹í™” ì‹œì‘
                                setTimeout(() => {
                                    startRecording(canvas);
                                }, 100);
                            }
                            
                            // ë…¹í™” ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
                            recordBtn.addEventListener('click', () => {
                                if (!isRecording) {
                                    // ë…¹í™” ì‹œì‘
                                    startRecording(canvas);
                                } else {
                                    // ë…¹í™” ì¤‘ì§€
                                    stopRecording();
                                }
                            });
                        }
                        
                        // ê²Œì„ ìƒíƒœ í‘œì‹œ
                        const statusDiv = document.createElement('div');
                        statusDiv.style.cssText = 'color: green; margin-top: 10px; font-weight: bold;';
                        statusDiv.textContent = 'ê²Œì„ ì§„í–‰ ì¤‘...';
                        startBtn.parentNode.appendChild(statusDiv);
                        
                        // ìº”ë²„ìŠ¤ì— ì‹¤ì œ ê²Œì„ êµ¬í˜„
                        const canvas = document.getElementById('gameCanvas');
                        if (canvas) {
                            const ctx = canvas.getContext('2d');
                            
                            // ê²Œì„ ì„¤ì •
                            const BASE_SPEED = 2.5; // ê¸°ë³¸ ì´ë™ ì†ë„ (1.6 â†’ 2.5ë¡œ ì¦ê°€)
                            const ALPHA = 2.5; // ê°€ì† ë¯¼ê°ë„ (1.0 â†’ 2.5ë¡œ ì¦ê°€)
                            const SPEED_MIN = 2.0; // ìµœì†Œ ì†ë„ (1.2 â†’ 2.0ìœ¼ë¡œ ì¦ê°€)
                            const SPEED_MAX = 15.0; // ìµœëŒ€ ì†ë„ (8.0 â†’ 15.0ìœ¼ë¡œ ì¦ê°€)
                            const GROWTH_RATE = 0.3; // ì„±ì¥ë¥  (30%)
                            const SAME_SIZE_GROWTH_MODE = 'percentage'; // 'percentage' ë˜ëŠ” 'fixed'
                            const SAME_SIZE_GROWTH_VALUE = 0.3; // í¼ì„¼íŠ¸ ëª¨ë“œ: 0.3, ê³ ì • ëª¨ë“œ: 1.0
                            const ITEM_SPAWN_INTERVAL = 2000; // ì•„ì´í…œ ìŠ¤í° ì£¼ê¸° (2ì´ˆ)
                            
                            // ì‹œê°„ ê¸°ë°˜ ì ì§„ ê°€ì† ì„¤ì •
                            const TIME_ACCELERATION_FACTOR = 0.2; // ì‹œê°„ ê°€ì† ê³„ìˆ˜ (0.1 â†’ 0.2 = 20%ì”© ì¦ê°€)
                            const TIME_ACCELERATION_INTERVAL = 3000; // ê°€ì† ì ìš© ì£¼ê¸° (5ì´ˆ â†’ 3ì´ˆë§ˆë‹¤)
                            const MAX_TIME_ACCELERATION = 5.0; // ìµœëŒ€ ì‹œê°„ ê°€ì† ë°°ìœ¨ (3ë°° â†’ 5ë°°)
                            
                            // ë…¹í™” ê´€ë ¨ ë³€ìˆ˜
                            let mediaRecorder = null;
                            let recordedChunks = [];
                            let isRecording = false;
                            
                            // ë¶€í™œ ì˜ˆì‚° ê·œì¹™
                            const REVIVE_BUDGET_RULES = {
                                3: 0,      // 3ëª… ì´í•˜: ë¶€í™œ 0íšŒ
                                9: 1,      // 4-9ëª…: ë¶€í™œ 1íšŒ
                                14: 2,     // 10-14ëª…: ë¶€í™œ 1-2íšŒ (ëœë¤)
                                999: 2     // 15ëª… ì´ìƒ: ë¶€í™œ 2íšŒ
                            };
                            
                            // ë¶€í™œ ì˜ˆì‚° ê³„ì‚° í•¨ìˆ˜
                            function calculateReviveBudget(initialCount) {
                                for (const [maxCount, budget] of Object.entries(REVIVE_BUDGET_RULES)) {
                                    if (initialCount <= parseInt(maxCount)) {
                                        if (budget === 2 && initialCount <= 14) {
                                            // 10-14ëª…ì¼ ë•ŒëŠ” 1-2íšŒ ì¤‘ ëœë¤
                                            return Math.random() < 0.5 ? 1 : 2;
                                        }
                                        return budget;
                                    }
                                }
                                return 0;
                            }
                            
                            // ì‹œê°„ ê¸°ë°˜ ì ì§„ ê°€ì† ê³„ì‚° í•¨ìˆ˜
                            function calculateTimeAcceleration(currentTime, gameStartTime, lastAccelerationTime, currentMultiplier) {
                                const elapsedTime = currentTime - gameStartTime;
                                const timeSinceLastAcceleration = currentTime - lastAccelerationTime;
                                
                                // ê°€ì† ì ìš© ì£¼ê¸°ë§ˆë‹¤ ì ì§„ì ìœ¼ë¡œ ê°€ì†
                                if (timeSinceLastAcceleration >= TIME_ACCELERATION_INTERVAL) {
                                    const newMultiplier = Math.min(
                                        MAX_TIME_ACCELERATION,
                                        currentMultiplier + TIME_ACCELERATION_FACTOR
                                    );
                                    
                                    console.log(`ì‹œê°„ ê°€ì† ì ìš©: ${currentMultiplier.toFixed(2)}x â†’ ${newMultiplier.toFixed(2)}x (ê²½ê³¼: ${(elapsedTime/1000).toFixed(1)}ì´ˆ)`);
                                    
                                    return {
                                        multiplier: newMultiplier,
                                        lastTime: currentTime
                                    };
                                }
                                
                                return {
                                    multiplier: currentMultiplier,
                                    lastTime: lastAccelerationTime
                                };
                            }
                            
                            // ì¸ì›ìˆ˜ ê¸°ë°˜ ì¶”ê°€ ê°€ì† ê³„ì‚° í•¨ìˆ˜
                            function calculateParticipantBonus(survivors, initialCount) {
                                const survivorRatio = survivors / initialCount;
                                
                                // ìƒì¡´ì ë¹„ìœ¨ì´ ë‚®ì„ìˆ˜ë¡ ì¶”ê°€ ê°€ì†
                                if (survivorRatio <= 0.3) {
                                    return 2.5; // 30% ì´í•˜: 2.5ë°° ì¶”ê°€ ê°€ì†
                                } else if (survivorRatio <= 0.5) {
                                    return 2.0; // 50% ì´í•˜: 2.0ë°° ì¶”ê°€ ê°€ì†
                                } else if (survivorRatio <= 0.7) {
                                    return 1.5; // 70% ì´í•˜: 1.5ë°° ì¶”ê°€ ê°€ì†
                                } else {
                                    return 1.0; // 70% ì´ˆê³¼: ê¸°ë³¸ ê°€ì†
                                }
                            }
                            
                            // ë…¹í™” ì‹œì‘ í•¨ìˆ˜
                            function startRecording(canvas) {
                                try {
                                    const stream = canvas.captureStream(30); // 30 FPS
                                    mediaRecorder = new MediaRecorder(stream, {
                                        mimeType: 'video/webm;codecs=vp9'
                                    });
                                    
                                    recordedChunks = [];
                                    
                                    mediaRecorder.ondataavailable = (event) => {
                                        if (event.data.size > 0) {
                                            recordedChunks.push(event.data);
                                        }
                                    };
                                    
                                    mediaRecorder.onstop = () => {
                                        const blob = new Blob(recordedChunks, { type: 'video/webm' });
                                        const url = URL.createObjectURL(blob);
                                        const a = document.createElement('a');
                                        a.href = url;
                                        a.download = `ë½‘ê¸°ì‹œë®¬ë ˆì´í„°_${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.webm`;
                                        a.click();
                                        URL.revokeObjectURL(url);
                                    };
                                    
                                    mediaRecorder.start();
                                    isRecording = true;
                                    
                                    // ë²„íŠ¼ ìƒíƒœ ë³€ê²½
                                    const recordBtn = document.getElementById('recordBtn');
                                    if (recordBtn) {
                                        recordBtn.textContent = 'ë…¹í™” ì¤‘â€¦ (ì¤‘ì§€)';
                                        recordBtn.className = 'btn btn-danger';
                                    }
                                    
                                    console.log('ë…¹í™” ì‹œì‘ë¨');
                                } catch (error) {
                                    console.error('ë…¹í™” ì‹œì‘ ì‹¤íŒ¨:', error);
                                    alert('ë…¹í™”ë¥¼ ì‹œì‘í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì €ê°€ ë…¹í™”ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                                }
                            }
                            
                            // ë…¹í™” ì¤‘ì§€ í•¨ìˆ˜
                            function stopRecording() {
                                if (mediaRecorder && isRecording) {
                                    mediaRecorder.stop();
                                    isRecording = false;
                                    
                                    // ë²„íŠ¼ ìƒíƒœ ë³µì›
                                    const recordBtn = document.getElementById('recordBtn');
                                    if (recordBtn) {
                                        recordBtn.className = 'btn btn-secondary';
                                        recordBtn.textContent = 'í™”ë©´ ë…¹í™”';
                                    }
                                    
                                    console.log('ë…¹í™” ì¤‘ì§€ë¨ - ìë™ ì €ì¥ ì™„ë£Œ');
                                }
                            }
                            
                            // ì„ íƒëœ ì°¸ê°€ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                            const selectedParticipants = [];
                            document.querySelectorAll('.radio-checkbox.selected').forEach((checkbox, index) => {
                                const participantId = checkbox.dataset.id;
                                const participantName = checkbox.parentNode.querySelector('.participant-name').textContent;
                                selectedParticipants.push({
                                    id: participantId,
                                    name: participantName,
                                    x: Math.random() * (canvas.width - 100) + 50,
                                    y: Math.random() * (canvas.height - 100) + 50,
                                    vx: (Math.random() - 0.5) * BASE_SPEED,
                                    vy: (Math.random() - 0.5) * BASE_SPEED,
                                    radius: 20,
                                    color: `hsl(${index * 360 / selectedCount}, 70%, 60%)`,
                                    speedMultiplier: 1.0,
                                    speedEndTime: 0,
                                    isInvincible: false,
                                    invincibleEndTime: 0,
                                    hasShuriken: false,
                                    shurikenEndTime: 0
                                });
                            });
                            
                            // ì•„ì´í…œ ë°°ì—´
                            const items = [];
                            let lastItemSpawn = Date.now();
                            
                            // ì•„ì´í…œ ìƒì„± í•¨ìˆ˜
                            function spawnItem() {
                                let itemTypes = ['speed', 'shuriken'];
                                let weights = [0.7, 0.3];
                                
                                // ë¶€í™œ ì˜ˆì‚°ì´ ë‚¨ì•„ìˆì„ ë•Œë§Œ ë¶€í™œ ì•„ì´í…œ ì¶”ê°€
                                if (reviveUsed < reviveBudget) {
                                    itemTypes.push('revive');
                                    weights = [0.5, 0.2, 0.3]; // ìŠ¤í”¼ë“œ, ë¶€í™œ, í‘œì°½
                                }
                                
                                // ê°€ì¤‘ì¹˜ ê¸°ë°˜ ëœë¤ ì„ íƒ
                                let random = Math.random();
                                let selectedType = itemTypes[0];
                                for (let i = 0; i < weights.length; i++) {
                                    if (random < weights[i]) {
                                        selectedType = itemTypes[i];
                                        break;
                                    }
                                    random -= weights[i];
                                }
                                
                                const item = {
                                    x: Math.random() * (canvas.width - 60) + 30,
                                    y: Math.random() * (canvas.height - 60) + 30,
                                    type: selectedType,
                                    radius: 24, // 12ì—ì„œ 24ë¡œ 2ë°° ì¦ê°€
                                    color: selectedType === 'speed' ? '#00ff00' : 
                                           selectedType === 'revive' ? '#ff00ff' : '#ff0000'
                                };
                                
                                items.push(item);
                            }
                            
                            // ê²Œì„ ìƒíƒœ
                            let gameRunning = true;
                            let survivors = selectedCount;
                            let initialCount = selectedCount; // ì´ˆê¸° ì°¸ê°€ì ìˆ˜ (ê³ ì •)
                            let gameStartTime = Date.now();
                            let reviveBudget = calculateReviveBudget(initialCount); // ë¶€í™œ ì˜ˆì‚°
                            let reviveUsed = 0; // ì‚¬ìš©ëœ ë¶€í™œ íšŸìˆ˜
                            
                            // ì‹œê°„ ê¸°ë°˜ ê°€ì† ìƒíƒœ
                            let timeAccelerationMultiplier = 1.0; // í˜„ì¬ ì‹œê°„ ê°€ì† ë°°ìœ¨
                            let lastAccelerationTime = Date.now(); // ë§ˆì§€ë§‰ ê°€ì† ì ìš© ì‹œê°„
                            
                            // ê²Œì„ ë£¨í”„
                            const gameLoop = () => {
                                if (!gameRunning) return;
                                
                                const currentTime = Date.now();
                                
                                // ì‹œê°„ ê¸°ë°˜ ì ì§„ ê°€ì† ê³„ì‚° ë° ì ìš©
                                const accelerationResult = calculateTimeAcceleration(
                                    currentTime, 
                                    gameStartTime, 
                                    lastAccelerationTime, 
                                    timeAccelerationMultiplier
                                );
                                timeAccelerationMultiplier = accelerationResult.multiplier;
                                lastAccelerationTime = accelerationResult.lastTime;
                                
                                // ë³µì‹±ì¥ ë°°ê²½ ê·¸ë¦¬ê¸°
                                // ë©”ì¸ ë§ ë°°ê²½
                                ctx.fillStyle = '#8B4513'; // ê°ˆìƒ‰ ë§
                                ctx.fillRect(0, 0, canvas.width, canvas.height);
                                
                                // ë§ í…Œë‘ë¦¬ (ë³µì‹±ì¥ ëŠë‚Œ)
                                ctx.strokeStyle = '#654321';
                                ctx.lineWidth = 8;
                                ctx.strokeRect(4, 4, canvas.width - 8, canvas.height - 8);
                                
                                // ë§ ë‚´ë¶€ (ë§¤íŠ¸ ëŠë‚Œ)
                                ctx.fillStyle = '#D2691E';
                                ctx.fillRect(12, 12, canvas.width - 24, canvas.height - 24);
                                
                                // ë§ ì¤‘ì•™ ì› (ë³µì‹±ì¥ ì¤‘ì•™ ë§ˆí¬)
                                ctx.strokeStyle = '#654321';
                                ctx.lineWidth = 3;
                                ctx.beginPath();
                                ctx.arc(canvas.width / 2, canvas.height / 2, 80, 0, Math.PI * 2);
                                ctx.stroke();
                                
                                // ì½”ë„ˆ ë§ˆí¬ (ë³µì‹±ì¥ ì½”ë„ˆ)
                                const cornerSize = 20;
                                ctx.fillStyle = '#654321';
                                // ì¢Œìƒë‹¨
                                ctx.fillRect(12, 12, cornerSize, cornerSize);
                                // ìš°ìƒë‹¨
                                ctx.fillRect(canvas.width - 32, 12, cornerSize, cornerSize);
                                // ì¢Œí•˜ë‹¨
                                ctx.fillRect(12, canvas.height - 32, cornerSize, cornerSize);
                                // ìš°í•˜ë‹¨
                                ctx.fillRect(canvas.width - 32, canvas.height - 32, cornerSize, cornerSize);
                                
                                // ì œëª©ê³¼ ì •ë³´ (ë³µì‹±ì¥ ìŠ¤íƒ€ì¼)
                                ctx.fillStyle = '#FFF';
                                ctx.font = 'bold 24px Arial';
                                ctx.textAlign = 'center';
                                ctx.fillText('ğŸ¥Š ë½‘ê¸° ì‹œë®¬ë ˆì´í„° ğŸ¥Š', canvas.width / 2, 30);
                                
                                ctx.font = 'bold 16px Arial';
                                ctx.fillText(`ìƒì¡´ì: ${survivors}ëª… / ëª©í‘œ: ${targetCount}ëª…`, canvas.width / 2, 55);
                                ctx.fillText(`ë¶€í™œ: ${reviveUsed}/${reviveBudget}íšŒ`, canvas.width / 2, 75);
                                
                                // ì†ë„ ìŠ¤ì¼€ì¼ë§ ì •ë³´ (ì¸ì›ìˆ˜ + ì‹œê°„ ê°€ì† + ì¸ì›ìˆ˜ ë³´ë„ˆìŠ¤)
                                const speedScale = Math.pow(initialCount / survivors, ALPHA);
                                const participantBonus = calculateParticipantBonus(survivors, initialCount);
                                const baseSpeedScaled = Math.max(SPEED_MIN, Math.min(SPEED_MAX, BASE_SPEED * speedScale * timeAccelerationMultiplier * participantBonus));
                                ctx.fillText(`ì†ë„ ë°°ìœ¨: ${baseSpeedScaled.toFixed(1)}x (ì¸ì›: ${speedScale.toFixed(1)}x, ì‹œê°„: ${timeAccelerationMultiplier.toFixed(1)}x, ë³´ë„ˆìŠ¤: ${participantBonus.toFixed(1)}x)`, canvas.width / 2, 95);
                                
                                // ì•„ì´í…œ ìŠ¤í°
                                if (currentTime - lastItemSpawn > ITEM_SPAWN_INTERVAL) {
                                    spawnItem();
                                    lastItemSpawn = currentTime;
                                }
                                
                                // ì•„ì´í…œ ì—…ë°ì´íŠ¸ ë° ê·¸ë¦¬ê¸°
                                items.forEach(item => {
                                    // ì•„ì´í…œ ê·¸ë¦¬ê¸° (ë³µì‹±ì¥ ìŠ¤íƒ€ì¼)
                                    // ì•„ì´í…œ ê·¸ë¦¼ì
                                    ctx.fillStyle = 'rgba(0, 0, 0, 0.4)';
                                    ctx.beginPath();
                                    ctx.arc(item.x + 3, item.y + 3, item.radius, 0, Math.PI * 2);
                                    ctx.fill();
                                    
                                    // ì•„ì´í…œ ì› (ë³µì‹±ì¥ ê¸€ë¡œë¸Œ ëŠë‚Œ)
                                    const itemGradient = ctx.createRadialGradient(
                                        item.x - item.radius * 0.3, 
                                        item.y - item.radius * 0.3, 
                                        0,
                                        item.x, 
                                        item.y, 
                                        item.radius
                                    );
                                    itemGradient.addColorStop(0, item.color);
                                    itemGradient.addColorStop(1, '#333');
                                    
                                    ctx.fillStyle = itemGradient;
                                    ctx.beginPath();
                                    ctx.arc(item.x, item.y, item.radius, 0, Math.PI * 2);
                                    ctx.fill();
                                    
                                    // ì•„ì´í…œ í…Œë‘ë¦¬ (ë³µì‹±ì¥ ê¸€ë¡œë¸Œ ëŠë‚Œ)
                                    ctx.strokeStyle = '#654321';
                                    ctx.lineWidth = 3;
                                    ctx.stroke();
                                    
                                    // ë‚´ë¶€ í•˜ì´ë¼ì´íŠ¸ (ë³µì‹±ì¥ ê¸€ë¡œë¸Œ ëŠë‚Œ)
                                    ctx.fillStyle = 'rgba(255, 255, 255, 0.3)';
                                    ctx.beginPath();
                                    ctx.arc(item.x - item.radius * 0.3, item.y - item.radius * 0.3, item.radius * 0.4, 0, Math.PI * 2);
                                    ctx.fill();
                                    
                                    // ì•„ì´í…œ íƒ€ì… í‘œì‹œ (ë³µì‹±ì¥ ìŠ¤íƒ€ì¼)
                                    ctx.fillStyle = '#FFF';
                                    ctx.font = 'bold 24px Arial';
                                    ctx.textAlign = 'center';
                                    ctx.strokeStyle = '#000';
                                    ctx.lineWidth = 2;
                                    const symbol = item.type === 'speed' ? 'âš¡' : 
                                                  item.type === 'revive' ? 'ğŸ’–' : 'ğŸ¥Š';
                                    ctx.strokeText(symbol, item.x, item.y + 8);
                                    ctx.fillText(symbol, item.x, item.y + 8); // y+3ì—ì„œ y+6ìœ¼ë¡œ ì¡°ì •
                                });
                                
                                // ì°¸ê°€ìë“¤ ì—…ë°ì´íŠ¸ ë° ê·¸ë¦¬ê¸°
                                selectedParticipants.forEach((participant, index) => {
                                    if (participant.radius <= 0) return; // ì‚¬ë§í•œ ì°¸ê°€ì
                                    
                                    // ë²„í”„ íš¨ê³¼ ì—…ë°ì´íŠ¸
                                    if (currentTime > participant.speedEndTime) {
                                        participant.speedMultiplier = 1.0;
                                    }
                                    if (currentTime > participant.invincibleEndTime) {
                                        participant.isInvincible = false;
                                    }
                                    if (currentTime > participant.shurikenEndTime) {
                                        participant.hasShuriken = false;
                                    }
                                    
                                    // ì†ë„ ìŠ¤ì¼€ì¼ë§ ê³„ì‚° (ì¸ì›ìˆ˜ + ì‹œê°„ ê°€ì† + ì¸ì›ìˆ˜ ë³´ë„ˆìŠ¤)
                                    const speedScale = Math.pow(initialCount / survivors, ALPHA);
                                    const participantBonus = calculateParticipantBonus(survivors, initialCount);
                                    const baseSpeedScaled = Math.max(SPEED_MIN, Math.min(SPEED_MAX, BASE_SPEED * speedScale * timeAccelerationMultiplier * participantBonus));
                                    
                                    // ìœ„ì¹˜ ì—…ë°ì´íŠ¸ (ì†ë„ ìŠ¤ì¼€ì¼ë§ + ì‹œê°„ ê°€ì† + ì¸ì›ìˆ˜ ë³´ë„ˆìŠ¤ + ë²„í”„ ì ìš©)
                                    participant.x += participant.vx * participant.speedMultiplier * (baseSpeedScaled / BASE_SPEED);
                                    participant.y += participant.vy * participant.speedMultiplier * (baseSpeedScaled / BASE_SPEED);
                                    
                                    // ë²½ ì¶©ëŒ ì²˜ë¦¬
                                    if (participant.x - participant.radius <= 0 || participant.x + participant.radius >= canvas.width) {
                                        participant.vx *= -1;
                                        participant.x = Math.max(participant.radius, Math.min(canvas.width - participant.radius, participant.x));
                                    }
                                    if (participant.y - participant.radius <= 0 || participant.y + participant.radius >= canvas.height) {
                                        participant.vy *= -1;
                                        participant.y = Math.max(participant.radius, Math.min(canvas.height - participant.radius, participant.y));
                                    }
                                    
                                    // ì•„ì´í…œ ìˆ˜ì§‘ ì²´í¬ (ì¤‘ë³µ ìˆ˜ì§‘ ë°©ì§€)
                                    items.forEach(item => {
                                        const dx = participant.x - item.x;
                                        const dy = participant.y - item.y;
                                        const distance = Math.sqrt(dx * dx + dy * dy);
                                        
                                        if (distance < participant.radius + item.radius) {
                                            // ì•„ì´í…œ íš¨ê³¼ ì ìš©
                                            if (item.type === 'speed') {
                                                // ìŠ¤í”¼ë“œ ì•„ì´í…œ ì¤‘ì²©: ì„ í˜• ì¦ê°€ (1 + count)
                                                participant.speedMultiplier += 1;
                                                participant.speedEndTime = currentTime + 6000; // 6ì´ˆ ì§€ì†
                                                console.log(`${participant.name}ì´(ê°€) ìŠ¤í”¼ë“œ ì•„ì´í…œì„ íšë“í–ˆìŠµë‹ˆë‹¤! (í˜„ì¬ ë°°ìœ¨: ${participant.speedMultiplier}x)`);
                                            } else if (item.type === 'revive') {
                                                // ë¶€í™œ ì˜ˆì‚° ì²´í¬
                                                if (reviveUsed >= reviveBudget) {
                                                    console.log('ë¶€í™œ ì˜ˆì‚°ì´ ì†Œì§„ë˜ì—ˆìŠµë‹ˆë‹¤!');
                                                    return;
                                                }
                                                
                                                // ì£½ì€ ì°¸ê°€ì ì¤‘ ëœë¤ ë¶€í™œ
                                                const deadParticipants = selectedParticipants.filter(p => p.radius <= 0);
                                                if (deadParticipants.length > 0) {
                                                    const revived = deadParticipants[Math.floor(Math.random() * deadParticipants.length)];
                                                    revived.radius = 15;
                                                    revived.x = Math.random() * (canvas.width - 100) + 50;
                                                    revived.y = Math.random() * (canvas.height - 100) + 50;
                                                    revived.isInvincible = true;
                                                    revived.invincibleEndTime = currentTime + 800; // 0.8ì´ˆ ë¬´ì 
                                                    revived.speedMultiplier = 1.0; // ì†ë„ ë²„í”„ ì´ˆê¸°í™”
                                                    revived.hasShuriken = false; // í‘œì°½ ë²„í”„ ì´ˆê¸°í™”
                                                    revived.speedEndTime = 0; // ì†ë„ ë²„í”„ ì‹œê°„ ì´ˆê¸°í™”
                                                    survivors++;
                                                    reviveUsed++;
                                                    console.log(`${revived.name}ì´(ê°€) ë¶€í™œí–ˆìŠµë‹ˆë‹¤! (ë¶€í™œ ${reviveUsed}/${reviveBudget})`);
                                                }
                                            } else if (item.type === 'shuriken') {
                                                participant.hasShuriken = true;
                                                participant.shurikenEndTime = currentTime + 5000; // 5ì´ˆ ì§€ì†
                                                console.log(`${participant.name}ì´(ê°€) í‘œì°½ ì•„ì´í…œì„ íšë“í–ˆìŠµë‹ˆë‹¤!`);
                                            }
                                            
                                            // ì•„ì´í…œ ìˆ˜ì§‘ í›„ ì¦‰ì‹œ ì œê±°
                                            const itemIndex = items.indexOf(item);
                                            if (itemIndex > -1) {
                                                items.splice(itemIndex, 1);
                                            }
                                        }
                                    });
                                    
                                    // ë‹¤ë¥¸ ì°¸ê°€ìì™€ì˜ ì¶©ëŒ ì²˜ë¦¬
                                    selectedParticipants.forEach((other, otherIndex) => {
                                        if (index === otherIndex || other.radius <= 0) return;
                                        
                                        const dx = participant.x - other.x;
                                        const dy = participant.y - other.y;
                                        const distance = Math.sqrt(dx * dx + dy * dy);
                                        
                                        if (distance < participant.radius + other.radius) {
                                            // ë¬´ì  ìƒíƒœ ì²´í¬
                                            if (participant.isInvincible || other.isInvincible) return;
                                            
                                            // í‘œì°½ ì•„ì´í…œ ì²´í¬
                                            if (participant.hasShuriken) {
                                                other.radius = 0;
                                                survivors--;
                                                console.log(`${participant.name}ì´(ê°€) í‘œì°½ìœ¼ë¡œ ${other.name}ì„(ë¥¼) ì²˜ì¹˜í–ˆìŠµë‹ˆë‹¤!`);
                                                return;
                                            }
                                            if (other.hasShuriken) {
                                                participant.radius = 0;
                                                survivors--;
                                                console.log(`${other.name}ì´(ê°€) í‘œì°½ìœ¼ë¡œ ${participant.name}ì„(ë¥¼) ì²˜ì¹˜í–ˆìŠµë‹ˆë‹¤!`);
                                                return;
                                            }
                                            
                                            // ì¼ë°˜ ì¶©ëŒ ì²˜ë¦¬
                                            if (participant.radius > other.radius) {
                                                // í° ì°¸ê°€ìê°€ ì‘ì€ ì°¸ê°€ì í¡ìˆ˜
                                                participant.radius += other.radius * GROWTH_RATE;
                                                other.radius = 0;
                                                survivors--;
                                                console.log(`${participant.name}ì´(ê°€) ${other.name}ì„(ë¥¼) í¡ìˆ˜í–ˆìŠµë‹ˆë‹¤!`);
                                            } else if (other.radius > participant.radius) {
                                                // ë‹¤ë¥¸ ì°¸ê°€ìê°€ ë” í° ê²½ìš°
                                                other.radius += participant.radius * GROWTH_RATE;
                                                participant.radius = 0;
                                                survivors--;
                                                console.log(`${other.name}ì´(ê°€) ${participant.name}ì„(ë¥¼) í¡ìˆ˜í–ˆìŠµë‹ˆë‹¤!`);
                                            } else {
                                                // ë™ì¼í•œ í¬ê¸° - ëœë¤ìœ¼ë¡œ ìŠ¹ë¶€ ê²°ì •
                                                const winner = Math.random() < 0.5 ? participant : other;
                                                const loser = winner === participant ? other : participant;
                                                
                                                // ì„±ì¥ëŸ‰ ê³„ì‚°
                                                let growthAmount;
                                                if (SAME_SIZE_GROWTH_MODE === 'percentage') {
                                                    growthAmount = loser.radius * SAME_SIZE_GROWTH_VALUE;
                                                } else {
                                                    growthAmount = SAME_SIZE_GROWTH_VALUE;
                                                }
                                                
                                                winner.radius += growthAmount;
                                                loser.radius = 0;
                                                survivors--;
                                                
                                                console.log(`${winner.name}ì´(ê°€) ${loser.name}ê³¼(ì™€)ì˜ ë™ë¥  ëŒ€ê²°ì—ì„œ ìŠ¹ë¦¬í–ˆìŠµë‹ˆë‹¤! (ì„±ì¥: +${growthAmount.toFixed(1)})`);
                                            }
                                            
                                            // ì¶©ëŒ íš¨ê³¼
                                            const effectX = (participant.x + other.x) / 2;
                                            const effectY = (participant.y + other.y) / 2;
                                            ctx.fillStyle = 'rgba(255, 0, 0, 0.3)';
                                            ctx.beginPath();
                                            ctx.arc(effectX, effectY, 30, 0, Math.PI * 2);
                                            ctx.fill();
                                        }
                                    });
                                    
                                    // ì°¸ê°€ì ê·¸ë¦¬ê¸° (ë³µì‹±ì¥ ìŠ¤íƒ€ì¼)
                                    if (participant.radius > 0) {
                                        // ê·¸ë¦¼ì (ë³µì‹±ì¥ ëŠë‚Œ)
                                        ctx.fillStyle = 'rgba(0, 0, 0, 0.4)';
                                        ctx.beginPath();
                                        ctx.arc(participant.x + 4, participant.y + 4, participant.radius, 0, Math.PI * 2);
                                        ctx.fill();
                                        
                                        // ì°¸ê°€ì ì› (ë³µì‹±ì¥ ê¸€ë¡œë¸Œ ëŠë‚Œ)
                                        const gradient = ctx.createRadialGradient(
                                            participant.x - participant.radius * 0.3, 
                                            participant.y - participant.radius * 0.3, 
                                            0,
                                            participant.x, 
                                            participant.y, 
                                            participant.radius
                                        );
                                        gradient.addColorStop(0, participant.color);
                                        gradient.addColorStop(1, '#333');
                                        
                                        ctx.fillStyle = gradient;
                                        ctx.beginPath();
                                        ctx.arc(participant.x, participant.y, participant.radius, 0, Math.PI * 2);
                                        ctx.fill();
                                        
                                        // í…Œë‘ë¦¬ (ë³µì‹±ì¥ ê¸€ë¡œë¸Œ ëŠë‚Œ)
                                        ctx.strokeStyle = participant.isInvincible ? '#FFD700' : '#654321';
                                        ctx.lineWidth = participant.isInvincible ? 5 : 3;
                                        ctx.stroke();
                                        
                                        // ë‚´ë¶€ í•˜ì´ë¼ì´íŠ¸ (ë³µì‹±ì¥ ê¸€ë¡œë¸Œ ëŠë‚Œ)
                                        ctx.fillStyle = 'rgba(255, 255, 255, 0.3)';
                                        ctx.beginPath();
                                        ctx.arc(participant.x - participant.radius * 0.3, participant.y - participant.radius * 0.3, participant.radius * 0.4, 0, Math.PI * 2);
                                        ctx.fill();
                                        
                                        // ì´ë¦„ í‘œì‹œ (ì˜ë¬¸ ID, ë³µì‹±ì¥ ìŠ¤íƒ€ì¼)
                                        ctx.fillStyle = '#FFF';
                                        ctx.font = 'bold 14px Arial';
                                        ctx.textAlign = 'center';
                                        ctx.strokeStyle = '#000';
                                        ctx.lineWidth = 2;
                                        ctx.strokeText(participant.id, participant.x, participant.y + 5);
                                        ctx.fillText(participant.id, participant.x, participant.y + 5);
                                        
                                        // ë²„í”„ íš¨ê³¼ í‘œì‹œ (ë³µì‹±ì¥ ìŠ¤íƒ€ì¼)
                                        if (participant.speedMultiplier > 1.0) {
                                            ctx.fillStyle = '#00ff00';
                                            ctx.font = 'bold 14px Arial';
                                            ctx.fillText('âš¡', participant.x, participant.y - participant.radius - 15);
                                        }
                                        if (participant.hasShuriken) {
                                            ctx.fillStyle = '#ff0000';
                                            ctx.font = 'bold 14px Arial';
                                            ctx.fillText('ğŸ¥Š', participant.x, participant.y - participant.radius - 30);
                                        }
                                    }
                                });
                                    
                                // ê²Œì„ ì¢…ë£Œ ì²´í¬
                                if (survivors <= targetCount) {
                                    gameRunning = false;
                                    
                                    // ë…¹í™” ì¤‘ì´ë©´ ìë™ìœ¼ë¡œ ì¤‘ì§€í•˜ê³  ì €ì¥
                                    if (isRecording) {
                                        stopRecording();
                                    }
                                    
                                    // ìš°ìŠ¹ì í‘œì‹œ (ë³µì‹±ì¥ ìŠ¤íƒ€ì¼)
                                    const winners = selectedParticipants.filter(p => p.radius > 0);
                                    
                                    // ë³µì‹±ì¥ ë§ ë°°ê²½ ìœ ì§€í•˜ë©´ì„œ ì–´ë‘¡ê²Œ
                                    ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                                    
                                    // ìš°ìŠ¹ì í…Œë‘ë¦¬ (ë³µì‹±ì¥ ë²¨íŠ¸ ëŠë‚Œ)
                                    ctx.strokeStyle = '#FFD700';
                                    ctx.lineWidth = 8;
                                    ctx.strokeRect(50, 50, canvas.width - 100, canvas.height - 100);
                                    
                                    ctx.fillStyle = '#FFD700';
                                    ctx.font = 'bold 36px Arial';
                                    ctx.textAlign = 'center';
                                    ctx.fillText('ğŸ¥Š ê²Œì„ ì¢…ë£Œ! ğŸ¥Š', canvas.width / 2, canvas.height / 2 - 60);
                                    
                                    ctx.fillStyle = '#FFF';
                                    ctx.font = 'bold 28px Arial';
                                    ctx.fillText(`ìš°ìŠ¹ì: ${winners.map(w => w.name).join(', ')}`, canvas.width / 2, canvas.height / 2);
                                    ctx.font = 'bold 24px Arial';
                                    ctx.fillText('ğŸ† ë‹¹ì²¨! ğŸ†', canvas.width / 2, canvas.height / 2 + 35);
                                    ctx.fillText(`ê²Œì„ ì‹œê°„: ${((Date.now() - gameStartTime) / 1000).toFixed(1)}ì´ˆ`, canvas.width / 2, canvas.height / 2 + 65);
                                    
                                    // ì´ˆê¸°í™” ë²„íŠ¼ ìƒì„±
                                    const resetBtn = document.createElement('button');
                                    resetBtn.textContent = 'ì´ˆê¸°í™”';
                                    resetBtn.className = 'btn btn-primary';
                                    resetBtn.style.cssText = 'margin-top: 20px;';
                                    resetBtn.onclick = () => {
                                        // ê²Œì„ ì™„ì „ ì´ˆê¸°í™”
                                        gameRunning = false; // ê²Œì„ ë£¨í”„ ì¤‘ë‹¨
                                        
                                        // ë…¹í™” ì¤‘ì´ë©´ ìë™ìœ¼ë¡œ ì¤‘ì§€
                                        if (isRecording) {
                                            stopRecording();
                                        }
                                        
                                        // ìº”ë²„ìŠ¤ ì´ˆê¸°í™”
                                        const ctx = canvas.getContext('2d');
                                        ctx.clearRect(0, 0, canvas.width, canvas.height);
                                        
                                        // ë³µì‹±ì¥ ë°°ê²½ ë‹¤ì‹œ ê·¸ë¦¬ê¸°
                                        ctx.fillStyle = '#8B4513';
                                        ctx.fillRect(0, 0, canvas.width, canvas.height);
                                        
                                        ctx.strokeStyle = '#654321';
                                        ctx.lineWidth = 8;
                                        ctx.strokeRect(4, 4, canvas.width - 8, canvas.height - 8);
                                        
                                        ctx.fillStyle = '#D2691E';
                                        ctx.fillRect(12, 12, canvas.width - 24, canvas.height - 24);
                                        
                                        ctx.strokeStyle = '#654321';
                                        ctx.lineWidth = 3;
                                        ctx.beginPath();
                                        ctx.arc(canvas.width / 2, canvas.height / 2, 80, 0, Math.PI * 2);
                                        ctx.stroke();
                                        
                                        const cornerSize = 20;
                                        ctx.fillStyle = '#654321';
                                        ctx.fillRect(12, 12, cornerSize, cornerSize);
                                        ctx.fillRect(canvas.width - 32, 12, cornerSize, cornerSize);
                                        ctx.fillRect(12, canvas.height - 32, cornerSize, cornerSize);
                                        ctx.fillRect(canvas.width - 32, canvas.height - 32, cornerSize, cornerSize);
                                        
                                        // ì´ˆê¸°í™” ì•ˆë‚´ ë©”ì‹œì§€
                                        ctx.fillStyle = '#FFF';
                                        ctx.font = 'bold 24px Arial';
                                        ctx.textAlign = 'center';
                                        ctx.fillText('ğŸ¥Š ê²Œì„ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤ ğŸ¥Š', canvas.width / 2, canvas.height / 2 - 30);
                                        ctx.font = 'bold 18px Arial';
                                        ctx.fillText('ì°¸ê°€ìë¥¼ ì„ íƒí•˜ê³  ê²Œì„ì„ ì‹œì‘í•˜ì„¸ìš”!', canvas.width / 2, canvas.height / 2 + 10);
                                        
                                        // ë²„íŠ¼ê³¼ ìƒíƒœ í‘œì‹œ ì œê±°
                                        buttonContainer.remove();
                                        
                                        // UI ìƒíƒœ ì´ˆê¸°í™”
                                        document.querySelectorAll('.radio-checkbox.selected').forEach(checkbox => {
                                            checkbox.classList.remove('selected');
                                        });
                                        document.getElementById('selectedCount').textContent = '0';
                                        document.getElementById('targetCount').value = '1';
                                        document.getElementById('startBtn').disabled = true;
                                        document.getElementById('recordBtn').disabled = true;
                                        document.getElementById('recordBtn').textContent = 'í™”ë©´ ë…¹í™”';
                                        document.getElementById('recordBtn').className = 'btn btn-secondary';
                                        document.getElementById('selectAllBtn').textContent = 'ì „ì²´ ì„ íƒ';
                                        
                                        // ì‹œê°„ ê°€ì† ë³€ìˆ˜ ì´ˆê¸°í™”
                                        timeAccelerationMultiplier = 1.0;
                                        lastAccelerationTime = Date.now();
                                        
                                        console.log('=== ê²Œì„ ì™„ì „ ì´ˆê¸°í™” ì™„ë£Œ ===');
                                    };
                                    
                                    // ë²„íŠ¼ì„ ìº”ë²„ìŠ¤ ì•„ë˜ì— ì¶”ê°€
                                    const buttonContainer = document.createElement('div');
                                    buttonContainer.style.cssText = 'text-align: center; margin-top: 20px;';
                                    buttonContainer.appendChild(resetBtn);
                                    
                                    const canvasContainer = canvas.parentNode;
                                    canvasContainer.appendChild(buttonContainer);
                                    
                                    return;
                                }
                                    
                                // ë‹¤ìŒ í”„ë ˆì„
                                requestAnimationFrame(gameLoop);
                            };
                            
                            // ê²Œì„ ì‹œì‘
                            console.log(`=== ê²Œì„ ì‹œì‘ ===`);
                            console.log(`ì´ˆê¸° ì°¸ê°€ì: ${initialCount}ëª…`);
                            console.log(`ë¶€í™œ ì˜ˆì‚°: ${reviveBudget}íšŒ`);
                            console.log(`ëª©í‘œ ìƒì¡´ì: ${targetCount}ëª…`);
                            console.log(`ì†ë„ ìŠ¤ì¼€ì¼ë§: alpha=${ALPHA}, min=${SPEED_MIN}, max=${SPEED_MAX}`);
                            console.log(`ë™ì¼ í¬ê¸° ì„±ì¥: ${SAME_SIZE_GROWTH_MODE} ëª¨ë“œ, ê°’=${SAME_SIZE_GROWTH_VALUE}`);
                            console.log(`ìŠ¤í”¼ë“œ ì•„ì´í…œ: ì„ í˜• ì¦ê°€ (1 + count) ë°°ìœ¨`);
                            console.log(`ì•„ì´í…œ ì†Œë©¸: ìˆ˜ì§‘ ì‹œ ì¦‰ì‹œ ì œê±°, ì‹œê°„ ì œí•œ ì—†ìŒ`);
                            gameLoop();
                        }
                    });
                }
            }
        });
    </script>
</body>
</html>
